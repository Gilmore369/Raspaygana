<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Landing page AKADEMICO</title>
  <!-- Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- GSAP -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js" referrerpolicy="no-referrer"></script>
  <style>
    :root { --color-vino:#5D001E; --color-dorado:#CFAE63; --color-negro:#0A0A0A; }
    body { background-color: var(--color-negro); color: white; }
    /* Overlay scratch */
    #scratchCardContainer { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); align-items: center; justify-content: center; z-index: 50; }
    #modalCard { position: relative; }
    #scratchCanvas { background-color: #b8b8b8; border-radius: 12px; touch-action: none; }
    #prizeText { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; font-size: 2rem; font-weight: 800; color: var(--color-vino); text-align: center; opacity: 0; padding: .5rem; pointer-events: none; }
    .confetti-piece { position: absolute; width: 8px; height: 12px; border-radius: 2px; will-change: transform, opacity; }
  </style>
</head>
<body class="antialiased font-sans">
  <div class="min-h-screen flex flex-col justify-between">
    <header class="py-8 px-4 text-center bg-[var(--color-vino)]">
      <h1 class="text-3xl md:text-4xl font-extrabold text-[var(--color-dorado)]">¬°Participa en el Raspa y Gana AKADEMICO y descubre tu premio!</h1>
      <p class="mt-2 text-lg md:text-xl text-white">Reg√≠strate, raspa y obt√©n descuentos o beneficios exclusivos en nuestros servicios acad√©micos.</p>
    </header>

    <main class="flex-grow p-4 md:p-8">
      <div class="max-w-4xl mx-auto grid lg:grid-cols-2 gap-8">
        <section class="bg-white rounded-lg shadow-lg p-6 text-gray-900">
          <h2 class="text-xl font-bold mb-4">Reg√≠strate para participar</h2>
          <form id="registrationForm" class="space-y-4">
            <div>
              <label for="name" class="block text-sm font-medium text-gray-700">Nombre completo</label>
              <input type="text" id="name" name="name" required class="mt-1 block w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md" />
              <p id="nameError" class="text-sm text-red-500 hidden">Ingresa tu nombre completo.</p>
            </div>
            <div>
              <label for="email" class="block text-sm font-medium text-gray-700">Correo electr√≥nico</label>
              <input type="email" id="email" name="email" required class="mt-1 block w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md" />
              <p id="emailError" class="text-sm text-red-500 hidden">Ingresa un correo v√°lido.</p>
            </div>
            <div>
              <label for="phone" class="block text-sm font-medium text-gray-700">N√∫mero de celular</label>
              <input type="tel" id="phone" name="phone" inputmode="numeric" pattern="\d{9}" required class="mt-1 block w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md" />
              <p id="phoneError" class="text-sm text-red-500 hidden">Ingresa un n√∫mero de 9 d√≠gitos.</p>
            </div>
            <div>
              <label for="level" class="block text-sm font-medium text-gray-700">Nivel acad√©mico</label>
              <select id="level" name="level" required class="mt-1 block w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md">
                <option value="" disabled selected>Selecciona tu nivel</option>
                <option value="Pregrado">Pregrado</option>
                <option value="Posgrado">Posgrado</option>
                <option value="Doctorado">Doctorado</option>
                <option value="Otros">Otros</option>
              </select>
              <p id="levelError" class="text-sm text-red-500 hidden">Selecciona tu nivel acad√©mico.</p>
            </div>
            <div>
              <label for="career" class="block text-sm font-medium text-gray-700">Carrera</label>
              <input type="text" id="career" name="career" required class="mt-1 block w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md" />
              <p id="careerError" class="text-sm text-red-500 hidden">Ingresa tu carrera.</p>
            </div>
            <div>
              <label for="university" class="block text-sm font-medium text-gray-700">Universidad</label>
              <input type="text" id="university" name="university" required class="mt-1 block w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md" />
              <p id="universityError" class="text-sm text-red-500 hidden">Ingresa tu universidad.</p>
            </div>
            <div>
              <label for="service" class="block text-sm font-medium text-gray-700">Servicio de inter√©s</label>
              <select id="service" name="service" required class="mt-1 block w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md">
                <option value="" disabled selected>Selecciona un servicio</option>
                <option>Asesor√≠a de Tesis</option>
                <option>Asesor√≠a y realizaci√≥n de Tesis Completa</option>
                <option>Asesor√≠a y realizaci√≥n de Proyecto de Tesis</option>
                <option>Asesor√≠a y realizaci√≥n de Informe de Tesis</option>
                <option>Trabajo acad√©mico de segunda especialidad / Suficiencia Profesional</option>
                <option>Asesor√≠a y realizaci√≥n de Monograf√≠a o Art√≠culo</option>
                <option>Asesor√≠a y realizaci√≥n de Tesinas</option>
                <option>Revisi√≥n sistem√°tica, narrativa y literaria</option>
                <option>Turnitin</option>
                <option>Parafraseo</option>
                <option>Levantamiento de observaciones</option>
              </select>
              <p id="serviceError" class="text-sm text-red-500 hidden">Selecciona un servicio de inter√©s.</p>
            </div>
            <div class="pt-4">
              <button type="submit" id="submitButton" class="w-full px-4 py-2 bg-[var(--color-vino)] text-white font-semibold rounded-md hover:bg-[var(--color-dorado)] transition-colors">¬°Raspa y gana ahora!</button>
            </div>
          </form>
        </section>

        <section class="space-y-6">
          <h2 class="text-xl font-bold">Beneficios de AKADEMICO</h2>
          <p>Acompa√±amiento especializado, cumplimiento estricto con normas acad√©micas y resultados garantizados en cada entrega.</p>
          <div class="grid grid-cols-2 gap-4">
            <div class="bg-[var(--color-vino)] rounded-lg p-4 flex items-center">üìö <p class="ml-3">Amplia biblioteca de recursos.</p></div>
            <div class="bg-[var(--color-vino)] rounded-lg p-4 flex items-center">üéì <p class="ml-3">Expertos con experiencia acad√©mica.</p></div>
            <div class="bg-[var(--color-vino)] rounded-lg p-4 flex items-center">ü™Ñ <p class="ml-3">Soluciones hechas a medida.</p></div>
            <div class="bg-[var(--color-vino)] rounded-lg p-4 flex items-center">ü¶ñ <p class="ml-3">Tradici√≥n y confianza acad√©mica.</p></div>
          </div>
          <p class="mt-4 font-semibold">Completa tu registro, raspa y gana tu beneficio. Con AKADEMICO, tu investigaci√≥n avanza con calidad y respaldo acad√©mico.</p>
        </section>
      </div>
    </main>

    <footer class="py-4 text-center text-sm text-gray-400 bg-[var(--color-vino)]">¬© 2025 AKADEMICO ‚Äì Todos los derechos reservados</footer>
  </div>

  <!-- Scratch card overlay -->
  <div id="scratchCardContainer" class="flex">
    <div id="modalCard" class="bg-white rounded-2xl shadow-2xl p-4 md:p-6">
      <div class="flex justify-end">
        <button id="closeScratchButton" class="text-[var(--color-vino)] font-semibold px-3 py-1 rounded hover:text-black">‚úï Cerrar</button>
      </div>
      <div class="relative">
        <canvas id="scratchCanvas" width="320" height="220"></canvas>
        <div id="prizeText"></div>
      </div>
      <p class="text-center text-sm text-gray-600 mt-3">¬°Raspa hasta revelar tu premio!</p>
    </div>
  </div>

  <audio id="aplausos" src="aplausos.mp3" preload="auto"></audio>

  <script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbx0G1GUKWCz9zfZPg_N1QATUCsYuLHu7ulGTqhSt7cDiIvHwcMtxd8-Yx2m5hCKVJxLEA/exec';

    const form = document.getElementById('registrationForm');
    const scratchCardContainer = document.getElementById('scratchCardContainer');
    const scratchCanvas = document.getElementById('scratchCanvas');
    const prizeText = document.getElementById('prizeText');
    const closeBtn = document.getElementById('closeScratchButton');
    const applauseAudio = document.getElementById('aplausos');

    let ctx, isDrawing = false, scratchedArea = 0, totalArea, isRevealed = false, lastPos = null;

    const prizes = ['10% de descuento','15% de descuento','20% de descuento','Asesor√≠a gratis de 30 minutos','Plantilla premium de tesis gratis','25% de descuento en un servicio completo'];
    const getRandomPrize = () => prizes[Math.floor(Math.random()*prizes.length)];

    // helpers de normalizaci√≥n
    const normalizePhone = (v) => (v||'').replace(/\D/g,'');

    function openOverlay(){
      scratchCardContainer.style.display = 'flex';
      gsap.fromTo('#scratchCardContainer',{opacity:0},{opacity:1,duration:0.25,ease:'power1.out'});
      gsap.fromTo('#modalCard',{y:40,scale:.95,opacity:0},{y:0,scale:1,opacity:1,duration:.35,ease:'power3.out'});
    }
    function closeOverlay(){
      gsap.timeline()
        .to('#modalCard',{y:20,scale:.98,opacity:0,duration:.2,ease:'power2.in'})
        .to('#scratchCardContainer',{opacity:0,duration:.2,onComplete:()=>{
          scratchCardContainer.style.display='none';
          document.querySelectorAll('.confetti-piece').forEach(el=>el.remove());
        }});
    }
    closeBtn.addEventListener('click', closeOverlay);

    function initScratchCard(){
      ctx = scratchCanvas.getContext('2d',{willReadFrequently:false});
      ctx.globalCompositeOperation = 'source-over';
      ctx.fillStyle = '#B0B0B0';
      ctx.fillRect(0,0,scratchCanvas.width,scratchCanvas.height);
      ctx.globalCompositeOperation = 'destination-out';
      ctx.lineCap = 'round';
      ctx.lineJoin = 'round';
      ctx.lineWidth = 28;
      scratchedArea = 0;
      totalArea = scratchCanvas.width * scratchCanvas.height;
      isRevealed = false;
      prizeText.style.opacity = 0;
      lastPos = null;
    }

    function getCanvasPos(e){
      const rect = scratchCanvas.getBoundingClientRect();
      const p = e.touches ? e.touches[0] : e;
      return { x: p.clientX - rect.left, y: p.clientY - rect.top };
    }
    function drawLine(from, to){
      if(!from) return;
      ctx.beginPath();
      ctx.moveTo(from.x, from.y);
      ctx.lineTo(to.x, to.y);
      ctx.stroke();
      scratchedArea += ctx.lineWidth * 18;
    }
    function startScratch(e){ isDrawing = true; lastPos = getCanvasPos(e); scratchMove(e); e.preventDefault(); }
    function endScratch(){ isDrawing = false; lastPos = null; }
    function scratchMove(e){
      if(!isDrawing) return;
      const pos = getCanvasPos(e);
      drawLine(lastPos, pos);
      lastPos = pos;
      if(!isRevealed && scratchedArea/totalArea > 0.45){ reveal(); }
      e.preventDefault();
    }
    scratchCanvas.addEventListener('mousedown', startScratch);
    scratchCanvas.addEventListener('mousemove', scratchMove);
    window.addEventListener('mouseup', endScratch);
    scratchCanvas.addEventListener('touchstart', startScratch, {passive:false});
    scratchCanvas.addEventListener('touchmove', scratchMove, {passive:false});
    window.addEventListener('touchend', endScratch);

    function playSound(){
      if (applauseAudio && applauseAudio.src) {
        applauseAudio.currentTime = 0;
        const p = applauseAudio.play();
        if (p && p.catch) p.catch(()=>beep());
      } else { beep(); }
    }
    function beep(){
      const audioCtx = new (window.AudioContext||window.webkitAudioContext)();
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type='triangle'; o.frequency.setValueAtTime(880,audioCtx.currentTime);
      o.connect(g); g.connect(audioCtx.destination); g.gain.setValueAtTime(0.2,audioCtx.currentTime);
      o.start(); o.stop(audioCtx.currentTime + 0.35);
    }

    function createConfetti(){
      const colors = ['#CFAE63','#5D001E','#FFD700','#FFFFFF','#A67C00'];
      const pieces = 70;
      for(let i=0;i<pieces;i++){
        const c = document.createElement('div');
        c.className = 'confetti-piece';
        c.style.left = (window.innerWidth*0.25 + Math.random()*window.innerWidth*0.5)+'px';
        c.style.top = (window.innerHeight*0.2)+'px';
        c.style.backgroundColor = colors[(Math.random()*colors.length)|0];
        scratchCardContainer.appendChild(c);
        gsap.fromTo(c,
          {y:-20, rotate:Math.random()*360, opacity:1, scale:gsap.utils.random(0.8,1.2)},
          {y: gsap.utils.random(500,900), x: gsap.utils.random(-220,220), rotate: "+=" + gsap.utils.random(360,1080), duration: gsap.utils.random(1.8,2.8), ease:"power2.out", onComplete: ()=>c.remove()});
      }
    }

    function reveal(){
      isRevealed = true;
      ctx.clearRect(0,0,scratchCanvas.width,scratchCanvas.height);
      ctx.globalCompositeOperation = 'source-over';
      gsap.to('#prizeText',{opacity:1, duration:.15});
      gsap.fromTo('#prizeText',{scale:0.6},{scale:1.05, duration:.45, ease:'back.out(1.7)'}).then(()=>{ gsap.to('#prizeText',{scale:1, duration:.2}); });
      playSound();
      createConfetti();
      setTimeout(()=>{ if (scratchCardContainer.style.display!=='none') closeOverlay(); }, 5000);
    }

    function toggleError(id, show){ document.getElementById(id).classList.toggle('hidden', !show); }
    function validateForm(){
      let valid = true;
      const name = form.name.value.trim();
      const email = form.email.value.trim();
      const phone = normalizePhone(form.phone.value.trim());
      const level = form.level.value; const career = form.career.value.trim();
      const university = form.university.value.trim(); const service = form.service.value;

      if (!name) { toggleError('nameError', true); valid = false; } else toggleError('nameError', false);
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) { toggleError('emailError', true); valid = false; } else toggleError('emailError', false);
      if (!/^\d{9}$/.test(phone)) { toggleError('phoneError', true); valid = false; } else toggleError('phoneError', false);
      if (!level) { toggleError('levelError', true); valid = false; } else toggleError('levelError', false);
      if (!career) { toggleError('careerError', true); valid = false; } else toggleError('careerError', false);
      if (!university) { toggleError('universityError', true); valid = false; } else toggleError('universityError', false);
      if (!service) { toggleError('serviceError', true); valid = false; } else toggleError('serviceError', false);
      return valid;
    }

    function localDuplicate(email, phone){
      const e = localStorage.getItem('ak-email');
      const p = localStorage.getItem('ak-phone');
      const ph = normalizePhone(phone);
      return (e && e===email) || (p && p===ph);
    }
    async function serverDuplicate(email, phone){
      try{
        const url = new URL(scriptURL);
        url.searchParams.set('check', '1');
        url.searchParams.set('email', email);
        url.searchParams.set('phone', normalizePhone(phone));
        const r = await fetch(url.toString(), {method:'GET'});
        if(!r.ok) return false; const data = await r.json();
        return !!data.duplicate;
      }catch(_){ return false; }
    }

    form.addEventListener('submit', async function(event) {
      event.preventDefault(); if (!validateForm()) return;

      const prize = getRandomPrize(); prizeText.textContent = prize;
      const formData = {
        name: form.name.value.trim(),
        email: form.email.value.trim(),
        phone: normalizePhone(form.phone.value.trim()),
        level: form.level.value,
        career: form.career.value.trim(),
        university: form.university.value.trim(),
        service: form.service.value,
        prize
      };

      if (localDuplicate(formData.email, formData.phone)) { alert('Ya participaste con este correo o n√∫mero desde este dispositivo.'); return; }
      if (await serverDuplicate(formData.email, formData.phone)) { alert('Ese correo o n√∫mero ya particip√≥.'); return; }

      initScratchCard(); openOverlay();

      try {
        const response = await fetch(scriptURL, {
          method: 'POST',
          mode: 'cors',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(formData)
        });
        if (response.ok) {
          console.log('Datos enviados correctamente');
        } else {
          console.error('Error Sheets:', response.statusText);
          alert('Error al enviar los datos');
        }
      } catch (err) {
        console.error('Error Sheets:', err);
        alert('Error al enviar los datos');
      }

      localStorage.setItem('ak-email', formData.email);
      localStorage.setItem('ak-phone', formData.phone);
    });

    window.addEventListener('load', initScratchCard);
  </script>
</body>
</html>
