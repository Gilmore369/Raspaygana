<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>¡Participa en el Raspa y Gana AKADEMICO!</title>
  <!-- Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    /*
      Configuración de Tailwind para definir la paleta de colores principal.
      Los tonos vino y dorado reflejan la estética de AKADEMICO.
    */
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            wine: '#5D001E', // tono de vino
            gold: '#CFAE63', // tono dorado suave
            black: '#0A0A0A'
          }
        }
      }
    }
  </script>
  <!-- React y ReactDOM desde CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- Framer Motion para animaciones -->
  <script src="https://unpkg.com/framer-motion/dist/framer-motion.umd.js"></script>
  <!-- Babel Standalone para compilar JSX en el navegador -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-black text-gold flex items-center justify-center min-h-screen p-4">
  <!-- Punto de montaje de React -->
  <div id="root" class="w-full"></div>

  <!-- Usamos el tipo text/babel para que Babel compile el JSX en este script -->
  <!-- Usamos Babel para compilar JSX. Especificamos los presets de entorno y React -->
  <script type="text/babel" data-presets="env,react">
    const { useState, useRef, useEffect } = React;
    const { motion } = window['framer-motion'];

    // Lista de premios configurables según lo solicitado
    const prizes = [
      '10% de descuento',
      '15% de descuento',
      '20% de descuento',
      'Asesoría gratis de 30 minutos',
      'Plantilla premium de tesis gratis',
      '25% de descuento en un servicio completo'
    ];

    /**
     * Componente ScratchCard
     * Renderiza un canvas interactivo que permite raspar para descubrir un premio.
     * Utiliza la técnica de dibujar círculos en modo destination-out para "borrar"
     * el recubrimiento gris. Al raspar más del 45 % del área, se dispara onComplete.
     */
    function ScratchCard({ onComplete, prize }) {
      const canvasRef = useRef(null);
      const [scratched, setScratched] = useState(false);

      useEffect(() => {
        const canvas = canvasRef.current;
        const ctx = canvas.getContext('2d');
        const rect = canvas.getBoundingClientRect();
        const width = rect.width;
        const height = rect.height;
        // Establecer dimensiones internas del canvas
        canvas.width = width;
        canvas.height = height;
        // Capa gris inicial
        ctx.fillStyle = '#999999';
        ctx.fillRect(0, 0, width, height);
        // Cambiar modo de composición para borrar
        ctx.globalCompositeOperation = 'destination-out';

        let scratchedArea = 0;
        const totalArea = width * height;

        function scratch(e) {
          // Obtener coordenadas relativas al canvas
          const clientX = e.touches ? e.touches[0].clientX : e.clientX;
          const clientY = e.touches ? e.touches[0].clientY : e.clientY;
          const x = clientX - rect.left;
          const y = clientY - rect.top;
          // Dibujar círculo para raspar
          ctx.beginPath();
          const radius = 20;
          ctx.arc(x, y, radius, 0, Math.PI * 2, false);
          ctx.fill();
          // Incrementar área raspada (aproximada)
          scratchedArea += Math.PI * radius * radius;
          // Si ya se raspó suficiente, disparar onComplete
          if (!scratched && scratchedArea / totalArea > 0.45) {
            setScratched(true);
            onComplete();
          }
        }

        // Eventos de mouse
        const handleMouseDown = (e) => {
          scratch(e);
          canvas.addEventListener('mousemove', scratch);
        };
        const handleMouseUp = () => {
          canvas.removeEventListener('mousemove', scratch);
        };
        canvas.addEventListener('mousedown', handleMouseDown);
        window.addEventListener('mouseup', handleMouseUp);
        // Eventos táctiles
        canvas.addEventListener('touchstart', scratch);
        canvas.addEventListener('touchmove', scratch);

        return () => {
          canvas.removeEventListener('mousedown', handleMouseDown);
          window.removeEventListener('mouseup', handleMouseUp);
          canvas.removeEventListener('mousemove', scratch);
          canvas.removeEventListener('touchstart', scratch);
          canvas.removeEventListener('touchmove', scratch);
        };
      }, [scratched, onComplete]);

      return (
        <div className="relative w-full h-40 md:h-56 mt-4 md:mt-8">
          {/* Premio visible debajo de la capa de raspar */}
          <div className="absolute inset-0 flex items-center justify-center bg-wine text-gold font-semibold text-lg md:text-2xl p-4 rounded-lg">
            {prize}
          </div>
          <canvas
            ref={canvasRef}
            className="absolute inset-0 w-full h-full rounded-lg cursor-pointer"
          />
        </div>
      );
    }

    /**
     * Componente principal de la aplicación
     * Gestiona el formulario, la validación, el envío a Google Sheets y la aparición de la tarjeta de raspar.
     */
    function App() {
      const [formData, setFormData] = useState({
        nombre: '',
        correo: '',
        celular: '',
        nivel: '',
        carrera: '',
        universidad: '',
        servicio: ''
      });
      const [errors, setErrors] = useState({});
      const [submitted, setSubmitted] = useState(false);
      const [prize, setPrize] = useState('');

      // Manejar cambios en los campos del formulario
      const handleChange = (e) => {
        setFormData({ ...formData, [e.target.name]: e.target.value });
      };

      // Validación de los campos
      const validate = () => {
        const errs = {};
        if (!formData.nombre.trim()) errs.nombre = 'Ingrese su nombre completo';
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(formData.correo)) errs.correo = 'Correo electrónico inválido';
        const phoneRegex = /^\d{9}$/;
        if (!phoneRegex.test(formData.celular)) errs.celular = 'El número debe tener 9 dígitos';
        if (!formData.nivel) errs.nivel = 'Seleccione su nivel académico';
        if (!formData.carrera.trim()) errs.carrera = 'Ingrese su carrera';
        if (!formData.universidad.trim()) errs.universidad = 'Ingrese su universidad';
        if (!formData.servicio) errs.servicio = 'Seleccione un servicio de interés';
        return errs;
      };

      // Envío del formulario
      const handleSubmit = async (e) => {
        e.preventDefault();
        const errs = validate();
        setErrors(errs);
        if (Object.keys(errs).length === 0) {
          // Intento de enviar a Google Sheets
          try {
            // Reemplazamos la URL del webhook de Google Apps Script con la URL real generada por el despliegue
            const scriptURL = 'https://script.google.com/macros/s/AKfycbyr1U3bfxSZ3V9eD-WsWyEkSOv2T7MAuNChyWfNVOB4mrs93iS-r08tJ00TykpwrnPp7A/exec';
            await fetch(scriptURL, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(formData)
            });
          } catch (err) {
            console.error(err);
          }
          // Seleccionar un premio aleatorio
          const randomPrize = prizes[Math.floor(Math.random() * prizes.length)];
          setPrize(randomPrize);
          setSubmitted(true);
        }
      };

      return (
        <div className="max-w-4xl w-full mx-auto bg-wine text-gold rounded-xl shadow-lg p-4 md:p-8 space-y-6">
          {/* Encabezado principal */}
          <div className="text-center">
            <motion.h1
              initial={{ opacity: 0, y: -20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.6 }}
              className="text-2xl md:text-4xl font-bold mb-2"
            >
              ¡Participa en el Raspa y Gana AKADEMICO y descubre tu premio!
            </motion.h1>
            <motion.p
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.8 }}
              className="text-base md:text-lg"
            >
              Regístrate, raspa y obtén descuentos o beneficios exclusivos en nuestros servicios académicos.
            </motion.p>
          </div>

          <div className="grid md:grid-cols-2 gap-6">
            {/* Sección de beneficios con iconos */}
            <div className="grid grid-cols-2 gap-4">
              <div className="bg-black rounded-lg p-4 flex flex-col items-center justify-center">
                { /* Imagen de libros */ }
                <img src="books.png" alt="Libros" className="w-16 h-16 mb-2" />
                <p className="text-center text-sm">Acompañamiento especializado</p>
              </div>
              <div className="bg-black rounded-lg p-4 flex flex-col items-center justify-center">
                { /* Imagen de graduación */ }
                <img src="graduation_cap.png" alt="Graduación" className="w-16 h-16 mb-2" />
                <p className="text-center text-sm">Cumplimiento con normas académicas</p>
              </div>
              <div className="bg-black rounded-lg p-4 flex flex-col items-center justify-center">
                { /* Imagen de varita mágica */ }
                <img src="magic_wand.png" alt="Varita mágica" className="w-16 h-16 mb-2" />
                <p className="text-center text-sm">Resultados garantizados</p>
              </div>
              <div className="bg-black rounded-lg p-4 flex flex-col items-center justify-center">
                { /* Imagen de dinosaurio académico */ }
                <img src="dinosaur.png" alt="Dinosaurio académico" className="w-16 h-16 mb-2" />
                <p className="text-center text-sm">¡Experiencia mágica!</p>
              </div>
            </div>

            {/* Formulario o tarjeta de raspar según el estado */}
            {!submitted ? (
              <form onSubmit={handleSubmit} className="space-y-4">
                <div>
                  <input
                    type="text"
                    name="nombre"
                    placeholder="Nombre completo"
                    value={formData.nombre}
                    onChange={handleChange}
                    className="w-full p-2 rounded-lg bg-black text-gold placeholder-gold/60 focus:outline-none"
                  />
                  {errors.nombre && <p className="text-red-400 text-sm">{errors.nombre}</p>}
                </div>
                <div>
                  <input
                    type="email"
                    name="correo"
                    placeholder="Correo electrónico"
                    value={formData.correo}
                    onChange={handleChange}
                    className="w-full p-2 rounded-lg bg-black text-gold placeholder-gold/60 focus:outline-none"
                  />
                  {errors.correo && <p className="text-red-400 text-sm">{errors.correo}</p>}
                </div>
                <div>
                  <input
                    type="tel"
                    name="celular"
                    placeholder="Número de celular (9 dígitos)"
                    value={formData.celular}
                    onChange={handleChange}
                    className="w-full p-2 rounded-lg bg-black text-gold placeholder-gold/60 focus:outline-none"
                  />
                  {errors.celular && <p className="text-red-400 text-sm">{errors.celular}</p>}
                </div>
                <div>
                  <select
                    name="nivel"
                    value={formData.nivel}
                    onChange={handleChange}
                    className="w-full p-2 rounded-lg bg-black text-gold focus:outline-none"
                  >
                    <option value="">Nivel académico</option>
                    <option value="Pregrado">Pregrado</option>
                    <option value="Posgrado">Posgrado</option>
                    <option value="Doctorado">Doctorado</option>
                    <option value="Otros">Otros</option>
                  </select>
                  {errors.nivel && <p className="text-red-400 text-sm">{errors.nivel}</p>}
                </div>
                <div>
                  <input
                    type="text"
                    name="carrera"
                    placeholder="Carrera (ej: Ingeniería Industrial)"
                    value={formData.carrera}
                    onChange={handleChange}
                    className="w-full p-2 rounded-lg bg-black text-gold placeholder-gold/60 focus:outline-none"
                  />
                  {errors.carrera && <p className="text-red-400 text-sm">{errors.carrera}</p>}
                </div>
                <div>
                  <input
                    type="text"
                    name="universidad"
                    placeholder="Universidad (ej: UPAO)"
                    value={formData.universidad}
                    onChange={handleChange}
                    className="w-full p-2 rounded-lg bg-black text-gold placeholder-gold/60 focus:outline-none"
                  />
                  {errors.universidad && <p className="text-red-400 text-sm">{errors.universidad}</p>}
                </div>
                <div>
                  <select
                    name="servicio"
                    value={formData.servicio}
                    onChange={handleChange}
                    className="w-full p-2 rounded-lg bg-black text-gold focus:outline-none"
                  >
                    <option value="">Servicio de interés</option>
                    <option value="Asesoría de Tesis">Asesoría de Tesis</option>
                    <option value="Asesoría y realización de Tesis Completa">Asesoría y realización de Tesis Completa</option>
                    <option value="Asesoría y realización de Proyecto de Tesis">Asesoría y realización de Proyecto de Tesis</option>
                    <option value="Asesoría y realización de Informe de Tesis">Asesoría y realización de Informe de Tesis</option>
                    <option value="Trabajo académico de segunda especialidad / Suficiencia Profesional">Trabajo académico de segunda especialidad / Suficiencia Profesional</option>
                    <option value="Asesoría y realización de Monografía o Artículo">Asesoría y realización de Monografía o Artículo</option>
                    <option value="Asesoría y realización de Tesinas">Asesoría y realización de Tesinas</option>
                    <option value="Revisión sistemática, narrativa y literaria">Revisión sistemática, narrativa y literaria</option>
                    <option value="Turnitin">Turnitin</option>
                    <option value="Parafraseo">Parafraseo</option>
                    <option value="Levantamiento de observaciones">Levantamiento de observaciones</option>
                  </select>
                  {errors.servicio && <p className="text-red-400 text-sm">{errors.servicio}</p>}
                </div>
                <button
                  type="submit"
                  className="w-full bg-gold text-wine font-bold py-3 rounded-lg hover:bg-yellow-500 transition-colors"
                >
                  ¡Raspa y gana ahora!
                </button>
              </form>
            ) : (
              <div className="flex flex-col items-center">
                <p className="text-lg md:text-xl mb-2">¡Ahora raspa para descubrir tu premio!</p>
                <ScratchCard prize={prize} onComplete={() => {}} />
                <p className="mt-4 text-sm">¡Gracias por participar! Nos pondremos en contacto contigo pronto.</p>
              </div>
            )}
          </div>

          <div className="text-center pt-4 border-t border-gold/30">
            <p className="text-base md:text-lg">
              Completa tu registro, raspa y gana tu beneficio. Con AKADEMICO, tu investigación avanza con calidad y respaldo académico.
            </p>
          </div>
        </div>
      );
    }

    // Montar la aplicación
    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>